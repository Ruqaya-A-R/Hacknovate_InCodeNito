<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mediscan â€” Profile</title>
  <link rel="stylesheet" href="/styles.css">

  <style>
    body {
      background: linear-gradient(to bottom, #0a1a3a, #0d244a);
      color: white;
      font-family: Arial, sans-serif;
    }

    /* ANALYZE UI */
    .analyze-box {
      width: 70%;
      margin: 40px auto;
      padding: 30px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.10);
      backdrop-filter: blur(12px);
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
      color: white;
    }

    .analyze-title {
      text-align: center;
      font-size: 28px;
      font-weight: 800;
      text-shadow: 0 0 8px rgba(0,0,0,0.5);
      margin-bottom: 20px;
    }

    .file-upload {
      display: block;
      width: 100%;
      padding: 20px;
      background: rgba(255,255,255,0.15);
      border: 2px dashed #9ecbff;
      color: #dbe9ff;
      border-radius: 16px;
      text-align: center;
      cursor: pointer;
      margin-bottom: 15px;
      font-size: 16px;
    }

    #fileInputHidden { display: none; }

    .analyze-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg,#3a7bd5,#00d2ff);
      border: none;
      border-radius: 14px;
      color: white;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: 0.3s;
    }

    .analyze-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }

    #ocrStatus {
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
      color: #ffbdbd;
    }

    /* OUTPUT BOX STYLE (THIS FIXES WHITE) */
    #result {
      margin-top: 20px;
      background: rgba(255,255,255,0.9); /* Slightly off-white */
      padding: 20px;
      border-radius: 12px;
      color: black;                 /* TEXT FIX */
      font-weight: 500;
      max-height: 500px;
      overflow-y: auto;
    }

    pre {
      background: #e8e8e8;
      padding: 10px;
      border-radius: 8px;
      color: black;                 /* TEXT FIX */
      white-space: pre-wrap;
      font-size: 15px;
    }

    /* HIDE MEDICINE GRID */
    #medicine-grid { display: none !important; }
  </style>
</head>

<body>

  <header class="site-header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo-neon">MS</div>
        <h1>Mediscan</h1>
      </div>

      <nav class="nav">
        <a href="/uploads">Uploads</a>
        <a href="/help">Help</a>
      </nav>
    </div>
  </header>

  <main class="app-container">

    <!-- PROFILE CARD -->
    <section class="profile-card">
      <div class="profile-avatar"></div>

      <div class="profile-meta">
        <h3>Profile Name</h3>
        <p>Update your display name and contact details</p>
        <input type="text" placeholder="Enter your name">
      </div>

      <div class="profile-actions">
        <button class="save-btn">Save</button>
      </div>
    </section>


    <!-- ANALYZE SECTION -->
    <section class="analyze-box">
      <h2 class="analyze-title">Analyze Prescription</h2>

      <label class="file-upload" id="fileLabel" for="fileInputHidden">
        Click to upload prescription
      </label>

      <input type="file" id="fileInputHidden" accept="image/*">

      <button class="analyze-btn" onclick="analyze()">Analyze</button>

      <div id="ocrStatus"></div>
      <div id="result"></div>
    </section>

  </main>


  <!-- UPDATE FILENAME ON SELECT -->
  <script>
    const hiddenInput = document.getElementById("fileInputHidden");
    const fileLabel = document.getElementById("fileLabel");

    hiddenInput.addEventListener("change", () => {
      if (hiddenInput.files[0]) {
        fileLabel.textContent = hiddenInput.files[0].name;
      }
    });
  </script>


  <!-- FIXED ANALYZE FUNCTION -->
  <script>
    async function analyze() {
      const file = hiddenInput.files[0];
      const status = document.getElementById("ocrStatus");
      const resultBox = document.getElementById("result");

      if (!file) {
        status.textContent = "Please select an image!";
        return;
      }

      status.textContent = "Analyzing... Please wait.";
      resultBox.innerHTML = "";

      const formdata = new FormData();
      formdata.append("file", file);

      try {
        const res = await
         fetch("https://semiotic-marianna-unexemptable.ngrok-free.dev/api/analyze", {
          method: "POST",
          body: formdata
        });

        const data = await res.json();
        status.textContent = "Analysis Completed!";

        let html = `
          <h3>Extracted Text</h3>
          <pre>${data.ocrText || "No text detected."}</pre>
          <h3>Detected Medicines</h3>
        `;

        if (data.detectedMedicines?.length > 0) {
          html += data.detectedMedicines.map(m => `
            <div style="background:#efefef;padding:10px;border-radius:8px;margin-bottom:10px;color:black;">
              <strong>${m.name}</strong><br>
              Dosage: ${m.dosage}<br>
              Timings: ${m.timings}<br>
              Warnings: ${m.warnings}<br>
              Purpose: ${m.purpose}
            </div>
          `).join("");
        } else {
          html += "<p>No medicines found.</p>";
        }

        resultBox.innerHTML = html;

      } catch (e) {
        status.textContent = "Error connecting to backend!";
        console.error(e);
      }
    }
  </script>

</body>
</html>
